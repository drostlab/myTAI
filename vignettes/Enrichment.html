<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />


<meta name="date" content="2021-02-23" />

<title>Enrichment Analyses</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Enrichment Analyses</h1>
<h4 class="date">2021-02-23</h4>



<div id="performing-phylostratum-and-divergence-stratum-enrichment-analyses" class="section level2">
<h2>Performing <code>Phylostratum</code> and <code>Divergence Stratum</code> Enrichment Analyses</h2>
<p><code>Phylostratum</code> and <code>Divergence Stratum</code> enrichment analyses have been performed by several studies to correlate organ or metabolic pathway evolution with the origin of organ or pathway specific genes (Sestak and Domazet-Loso, 2015).</p>
<p>In detail, <code>Phylostratum</code> and <code>Divergence Stratum</code> enrichment analyses can be performed analogously to <a href="https://geneontology.github.io/page/go-enrichment-analysis/">Gene Ontology</a> and <a href="https://www.genome.jp/kegg/">Kegg</a> enrichment analyses to study the enrichment of evolutionary age or sequence divergence in a set of selected genes against the entire genome/transcriptome. In case specific age categories are significantly over- or underrepresented in the selected gene set, assumptions or potential correlations between the evolutionary origin of a particular organ or metabolic pathway can be implied.</p>
<p>In this vignette we will use the data set published by Sestak and Domazet-Loso, 2015 to demonstrate how to perform enrichment analyses using <code>myTAI</code>.</p>
</div>
<div id="enrichment-analyses-using-plotenrichment" class="section level2">
<h2>Enrichment Analyses using <code>PlotEnrichment()</code></h2>
<p>The <code>PlotEnrichment()</code> function implemented in <code>myTAI</code> computes and visualizes the significance of enriched (over- or underrepresented) <code>Phylostrata</code> or <code>Divergence Strata</code> within an input set of process/tissue specific genes. In detail this function takes the <code>Phylostratum</code> or <code>Divergence Stratum</code> distribution of all genes stored in the input <code>ExpressionSet</code> as background set and the <code>Phylostratum</code> or <code>Divergence Stratum</code> distribution of the specific gene set and performs a Fisher’s exact test for each <code>Phylostratum</code> or <code>Divergence Stratum</code> to quantify the statistical significance of over- or under-represented <code>Phylostrata</code> or <code>Divergence Strata</code> within the set of selected genes. In other words, the frequency distribution of <code>Phylostrata</code> or <code>Divergence Strata</code> in the complete sample is compared with the frequency distribution of <code>Phylostrata</code> or <code>Divergence Strata</code> in the set of selected genes and over- or under-representation is visualized by log-odds (or odds), where a log-odd of zero means that both frequency distributions are equal (see also Sestak and Domazet-Loso, 2015).</p>
<div id="example-data-set-retrieval" class="section level3">
<h3>Example Data Set Retrieval</h3>
<p>Before using the <code>PlotEnrichment()</code> function, we need to download the example data set from Sestak and Domazet-Loso, 2015.</p>
<p>Download the <code>Phylostratigraphic Map</code> of <em>D. rerio</em>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># download the Phylostratigraphic Map of Danio rerio</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># from Sestak and Domazet-Loso, 2015</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">download.file</span>( <span class="dt">url      =</span> <span class="st">&quot;http://mbe.oxfordjournals.org/content/suppl/2014/11/17/msu319.DC1/TableS3-2.xlsx&quot;</span>, </span>
<span id="cb1-4"><a href="#cb1-4"></a>               <span class="dt">destfile =</span> <span class="st">&quot;MBE_2015a_Drerio_PhyloMap.xlsx&quot;</span> )</span>
<span id="cb1-5"><a href="#cb1-5"></a>               </span></code></pre></div>
<p>Read the <code>*.xlsx</code> file storing the <code>Phylostratigraphic Map</code> of <em>D. rerio</em> and format it for the use with <code>myTAI</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># install the readxl package</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">install.packages</span>(<span class="st">&quot;readxl&quot;</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co"># load package readxl</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">library</span>(readxl)</span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co"># read the excel file</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>DrerioPhyloMap.MBEa &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;MBE_2015a_Drerio_PhyloMap.xlsx&quot;</span>, <span class="dt">sheet =</span> <span class="dv">1</span>, <span class="dt">skip =</span> <span class="dv">4</span>)</span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co"># format Phylostratigraphic Map for use with myTAI</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>Drerio.PhyloMap &lt;-<span class="st"> </span>DrerioPhyloMap.MBEa[ , <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co"># have a look at the final format</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="kw">head</span>(Drerio.PhyloMap)</span></code></pre></div>
<pre><code>  Phylostrata            ZFIN_ID
1           1 ZDB-GENE-000208-13
2           1 ZDB-GENE-000208-17
3           1 ZDB-GENE-000208-18
4           1 ZDB-GENE-000208-23
5           1  ZDB-GENE-000209-3
6           1  ZDB-GENE-000209-4</code></pre>
<p>Now, <code>Drerio.PhyloMap</code> stores the <code>Phylostratigraphic Map</code> of <em>D. rerio</em> which is used as background set to perform enrichment analyses with <code>PlotEnrichment()</code>.</p>
</div>
<div id="enrichment-analyses" class="section level3">
<h3>Enrichment Analyses</h3>
<p>Now, the <code>PlotEnrichment()</code> function visualizes the over- and underrepresented <code>Phylostrata</code> of brain specific genes when compared with the total number of genes stored in the <code>Phylostratigraphic Map</code> of <em>D. rerio</em>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># read expression data (organ specific genes) from Sestak and Domazet-Loso, 2015</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>Drerio.OrganSpecificExpression &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;MBE_2015a_Drerio_PhyloMap.xlsx&quot;</span>, <span class="dt">sheet =</span> <span class="dv">2</span>, <span class="dt">skip =</span> <span class="dv">3</span>)</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a><span class="co"># select only brain specific genes</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>Drerio.Brain.Genes &lt;-<span class="st"> </span><span class="kw">unique</span>(<span class="kw">na.omit</span>(Drerio.OrganSpecificExpression[ , <span class="st">&quot;brain&quot;</span>]))</span>
<span id="cb4-6"><a href="#cb4-6"></a></span>
<span id="cb4-7"><a href="#cb4-7"></a><span class="co"># visualize enriched Phylostrata of genes annotated as brain specific</span></span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="kw">PlotEnrichment</span>(Drerio.PhyloMap,</span>
<span id="cb4-9"><a href="#cb4-9"></a>               <span class="dt">test.set     =</span> Drerio.Brain.Genes,</span>
<span id="cb4-10"><a href="#cb4-10"></a>               <span class="dt">measure      =</span> <span class="st">&quot;log-foldchange&quot;</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a>               <span class="dt">use.only.map =</span> <span class="ot">TRUE</span>,</span>
<span id="cb4-12"><a href="#cb4-12"></a>               <span class="dt">legendName   =</span> <span class="st">&quot;PS&quot;</span>)</span></code></pre></div>
<p>Here, the first argument is either a standard <code>ExpressionSet</code> object (in case <code>use.only.map = FALSE</code>: default) or a <code>Phylostratigraphic Map</code> or <code>Divergence Map</code> (in case <code>use.only.map = TRUE</code>; see <a href="Introduction.html">Introduction</a> for details). The second argument <code>test.set</code> specifies the gene ids also stored in the corresponding <code>ExpressionSet</code> or <code>Phylostratigraphic Map/ Divergence Map</code> for which enrichment shall be quantified and visualized.</p>
<p>To visualize the odds or log-odds of over- or underrepresented genes within the <code>test.set</code> the following procedure is performed:</p>
<ul>
<li><p><span class="math inline">\(N_{ij}\)</span> denotes the number of genes in group j and deriving from PS <span class="math inline">\(i\)</span>, with <span class="math inline">\(i = 1, .. , n\)</span> and where <span class="math inline">\(j = 1\)</span> denotes the background set and <span class="math inline">\(j = 2\)</span> denotes the <code>test.set</code></p></li>
<li><p><span class="math inline">\(N_{i.}\)</span> denotes the total number of genes within PS <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(N_{.j}\)</span> denotes the total number of genes within group <span class="math inline">\(j\)</span></p></li>
<li><p><span class="math inline">\(N_{..}\)</span> is the total number of genes within all groups <span class="math inline">\(j\)</span> and all PS <span class="math inline">\(i\)</span></p></li>
<li><p><span class="math inline">\(f_{ij}\)</span> = <span class="math inline">\(N_{ij}\)</span> / <span class="math inline">\(N_{..}\)</span> and <span class="math inline">\(g_{ij}\)</span> = <span class="math inline">\(f_{ij}\)</span> / <span class="math inline">\(f_{.j}\)</span> denote relative frequencies between groups</p></li>
<li><p><span class="math inline">\(f_{i.}\)</span> denotes the between group sum of <span class="math inline">\(f_{ij}\)</span></p></li>
</ul>
<p>The result is the <strong>fold-change value</strong> (odds; <code>measure = &quot;foldchange&quot;</code>) denoted as <span class="math inline">\(C_2 = g_{i2} / f_{i.}\)</span> which is visualized above and below zero or the <strong>log fold-change</strong> value (log-odds; <code>measure = &quot;log-foldchange&quot;</code>), where <span class="math inline">\(log_2\)</span>(C) = <span class="math inline">\(log_2\)</span>(<span class="math inline">\(g_{i2}\)</span>) - <span class="math inline">\(log_2\)</span>(<span class="math inline">\(f_{i.}\)</span>) which is visualized symmetrically above and below zero by <code>PlotEnrichment()</code>. Analogously, <span class="math inline">\(C_1 = g_{i1} / f_{i.}\)</span> but is not visualized by this function.</p>
<p>Internally, <code>PlotEnrichment()</code> performs a Fisher’s exact test for each <code>Phylostratum</code> or <code>Divergence Stratum</code> separately, to quantify the significance of over- or under-representation of corresponding <code>Phylostrata</code> or <code>Divergence Strata</code> within the <code>test.set</code> when compared with the entire <code>ExpressionSet</code>. <code>PlotEnrichment()</code> visualizes significantly enriched (over- or underrepresented) <code>Phylostrata</code> or <code>Divergence Strata</code> with asterisks ’*’.</p>
<p>Notation:</p>
<ul>
<li>’*’ = P-Value <span class="math inline">\(\leq\)</span> 0.05</li>
<li>’**’ = P-Value <span class="math inline">\(\leq\)</span> 0.005</li>
<li>’***’ = P-Value <span class="math inline">\(\leq\)</span> 0.0005</li>
</ul>
<p>Users will notice that when performing the <code>PlotEnrichment()</code> function, the p-values and the enrichment matrix (storing <span class="math inline">\(C_1\)</span> and <span class="math inline">\(C_2\)</span>) will be returned.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">PlotEnrichment</span>(Drerio.PhyloMap,</span>
<span id="cb5-2"><a href="#cb5-2"></a>               <span class="dt">test.set     =</span> Drerio.Brain.Genes,</span>
<span id="cb5-3"><a href="#cb5-3"></a>               <span class="dt">measure      =</span> <span class="st">&quot;log-foldchange&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>               <span class="dt">use.only.map =</span> <span class="ot">TRUE</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>               <span class="dt">legendName   =</span> <span class="st">&quot;PS&quot;</span>)</span></code></pre></div>
<pre><code>$p.values
         PS1          PS2          PS3          PS4          PS5          PS6 
8.283490e-01 8.362880e-05 6.778981e-02 1.373816e-02 7.946309e-13 6.017041e-01 
         PS7          PS8          PS9         PS10         PS11         PS12 
2.185021e-03 2.281194e-03 8.943147e-01 5.699612e-01 4.717058e-02 9.367759e-01 
        PS13         PS14 
3.929949e-03 1.593834e-05 

$enrichment.matrix
           BG_Set     Test_Set
PS1  -0.001132832  0.007668216
PS2   0.023733936 -0.172380714
PS3  -0.040879607  0.250587496
PS4  -0.048920465  0.294399729
PS5  -0.114888949  0.603817643
PS6   0.008678915 -0.060350168
PS7  -0.062948352  0.367240944
PS8   0.115630474 -1.206210187
PS9  -0.007353969  0.048964218
PS10 -0.031971192  0.200141519
PS11  0.039742253 -0.303363314
PS12 -0.002418079  0.016311853
PS13  0.101449988 -0.984621732
PS14  0.098211044 -0.938724783</code></pre>
<p>In case users are only interested in the p-values of the Fisher test and the enrichment matrix without illustrating the bar plot, they can specify the <code>plot.bars = FALSE</code> argument to only retrieve the numeric results.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># specify plot.bars = FALSE to retrieve only numeric results</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>EnrichmentResult &lt;-<span class="st"> </span><span class="kw">PlotEnrichment</span>(Drerio.PhyloMap,</span>
<span id="cb7-3"><a href="#cb7-3"></a>                                   <span class="dt">test.set     =</span> Drerio.Brain.Genes,</span>
<span id="cb7-4"><a href="#cb7-4"></a>                                   <span class="dt">measure      =</span> <span class="st">&quot;log-foldchange&quot;</span>,</span>
<span id="cb7-5"><a href="#cb7-5"></a>                                   <span class="dt">use.only.map =</span> <span class="ot">TRUE</span>,</span>
<span id="cb7-6"><a href="#cb7-6"></a>                                   <span class="dt">legendName   =</span> <span class="st">&quot;PS&quot;</span>,</span>
<span id="cb7-7"><a href="#cb7-7"></a>                                   <span class="dt">plot.bars    =</span> <span class="ot">FALSE</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># access p-values quantifying the enrichment for each Phylostratum</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>EnrichmentResult<span class="op">$</span>p.values</span></code></pre></div>
<pre><code>         PS1          PS2          PS3          PS4          PS5          PS6 
8.283490e-01 8.362880e-05 6.778981e-02 1.373816e-02 7.946309e-13 6.017041e-01 
         PS7          PS8          PS9         PS10         PS11         PS12 
2.185021e-03 2.281194e-03 8.943147e-01 5.699612e-01 4.717058e-02 9.367759e-01 
        PS13         PS14 
3.929949e-03 1.593834e-05</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># access enrichment matrix storing C_1 and C_2</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>EnrichmentResult<span class="op">$</span>enrichment.matrix</span></code></pre></div>
<pre><code>           BG_Set     Test_Set
PS1  -0.001132832  0.007668216
PS2   0.023733936 -0.172380714
PS3  -0.040879607  0.250587496
PS4  -0.048920465  0.294399729
PS5  -0.114888949  0.603817643
PS6   0.008678915 -0.060350168
PS7  -0.062948352  0.367240944
PS8   0.115630474 -1.206210187
PS9  -0.007353969  0.048964218
PS10 -0.031971192  0.200141519
PS11  0.039742253 -0.303363314
PS12 -0.002418079  0.016311853
PS13  0.101449988 -0.984621732
PS14  0.098211044 -0.938724783</code></pre>
</div>
<div id="defining-the-background-set" class="section level3">
<h3>Defining the Background Set</h3>
<p>The Fisher test which is performed inside <code>PlotEnrichment()</code> assumes that all genes stored in the input <code>ExpressionSet</code> or <code>Phylostratigraphic Map</code>/<code>Divergence Map</code> are used to define the background set for constructing the test statistic. However, since in most cases the <code>test.set</code> is an subset of the input <code>ExpressionSet</code> or <code>Phylostratigraphic Map</code>/<code>Divergence Map</code> one could also specify the <code>complete.bg</code> argument to remove all <code>test.set</code> genes from the background set when performing the Fisher test and visualization.</p>
<p>The following two examples allow users to compare the results when retaining all genes as background set compared with the option to remove <code>test.set</code> genes from the background set.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># complete.bg = TRUE (default) -&gt; retain test.set genes in background set</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="kw">PlotEnrichment</span>(Drerio.PhyloMap,</span>
<span id="cb11-3"><a href="#cb11-3"></a>               <span class="dt">test.set     =</span> Drerio.Brain.Genes,</span>
<span id="cb11-4"><a href="#cb11-4"></a>               <span class="dt">measure      =</span> <span class="st">&quot;log-foldchange&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>               <span class="dt">complete.bg  =</span> <span class="ot">TRUE</span>,</span>
<span id="cb11-6"><a href="#cb11-6"></a>               <span class="dt">use.only.map =</span> <span class="ot">TRUE</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>               <span class="dt">legendName   =</span> <span class="st">&quot;PS&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># complete.bg = FALSE -&gt; remove test.set genes from background set</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="kw">PlotEnrichment</span>(Drerio.PhyloMap,</span>
<span id="cb12-3"><a href="#cb12-3"></a>               <span class="dt">test.set     =</span> Drerio.Brain.Genes,</span>
<span id="cb12-4"><a href="#cb12-4"></a>               <span class="dt">measure      =</span> <span class="st">&quot;log-foldchange&quot;</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>               <span class="dt">complete.bg  =</span> <span class="ot">FALSE</span>,</span>
<span id="cb12-6"><a href="#cb12-6"></a>               <span class="dt">use.only.map =</span> <span class="ot">TRUE</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a>               <span class="dt">legendName   =</span> <span class="st">&quot;PS&quot;</span>)</span></code></pre></div>
<p>Users will notice that although some p-values change, the qualitative result did not change. In border line cases however, the results might influence whether or not some <code>Phylostrata</code> or <code>Divergence Strata</code> are denoted as significantly enriched or not. So always be aware of the interpretation when retaining or removing the <code>test.set</code> from the background set, because both options are valid and have advantages and disadvantages and depend on a valid interpretation.</p>
</div>
</div>
<div id="interpretation-of-enrichment-results" class="section level2">
<h2>Interpretation of Enrichment Results</h2>
<p>For the <em>D. rerio</em> brain genes example you can see that PS4, PS5, and PS7 are significantly over-represented in the set of brain specific genes.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="kw">PlotEnrichment</span>(Drerio.PhyloMap,</span>
<span id="cb13-2"><a href="#cb13-2"></a>               <span class="dt">test.set     =</span> Drerio.Brain.Genes,</span>
<span id="cb13-3"><a href="#cb13-3"></a>               <span class="dt">measure      =</span> <span class="st">&quot;foldchange&quot;</span>,</span>
<span id="cb13-4"><a href="#cb13-4"></a>               <span class="dt">complete.bg  =</span> <span class="ot">TRUE</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>               <span class="dt">use.only.map =</span> <span class="ot">TRUE</span>,</span>
<span id="cb13-6"><a href="#cb13-6"></a>               <span class="dt">legendName   =</span> <span class="st">&quot;PS&quot;</span>)</span></code></pre></div>
<p>Again, we retrieve the <em>D. rerio</em> specific taxonomy represented by PS1-14 using the <code>taxonomy()</code> funtion (see <a href="Introduction.html">Introduction</a> and <a href="Taxonomy.html">Taxonomy</a> for details).</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># retrieve the taxonomy of D. rerio</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="kw">taxonomy</span>(<span class="dt">organism =</span> <span class="st">&quot;Danio rerio&quot;</span>)</span></code></pre></div>
<pre><code>                    id         name    rank
1   cellular organisms      no rank  131567
2            Eukaryota superkingdom    2759
3         Opisthokonta      no rank   33154
4              Metazoa      kingdom   33208
5            Eumetazoa      no rank    6072
6            Bilateria      no rank   33213
7        Deuterostomia      no rank   33511
8             Chordata       phylum    7711
9             Craniata    subphylum   89593
10          Vertebrata      no rank    7742
11       Gnathostomata      no rank    7776
12          Teleostomi      no rank  117570
13        Euteleostomi      no rank  117571
14      Actinopterygii   superclass    7898
15         Actinopteri        class  186623
16         Neopterygii     subclass   41665
17           Teleostei   infraclass   32443
18 Osteoglossocephalai      no rank 1489341
19       Clupeocephala      no rank  186625
20           Otomorpha      no rank  186634
21        Ostariophysi      no rank   32519
22            Otophysa      no rank  186626
23       Cypriniphysae   superorder  186627
24       Cypriniformes        order    7952
25         Cyprinoidea  superfamily   30727
26          Cyprinidae       family    7953
27               Danio        genus    7954
28         Danio rerio      species    7955</code></pre>
<p>Sestak and Domazet-Loso, 2015 collapsed these 28 taxonomic nodes into 14 taxonomic nodes (see <code>Figure 2</code> in Sestak and Domazet-Loso, 2015) and labelled them as phylostrata 1 to phylostrata 14, where PS1 represents <code>cellular organisms</code> and PS14 represents <code>D. rerio</code> specific genes. Based on the phylostratum categorization of Sestak and Domazet-Loso, 2015, PS4 represents <code>Holozoa (= Metazoa + allies)</code>, PS5 represents <code>Metazoa</code>, and PS7 represents <code>Bilateria</code>.</p>
<p>Now, the over-representation results of brain specific genes returned by <code>PlotEnrichment()</code> provide evidence, that brain specific genes might indeed have originated during the emergence of the nervous system at the metazoan-eumetazoan transition leading to the interpretation that the vertebrate brain has a step wise adaptive history where most of its extant organization was already present in the chordate ancestor as argued by Sestak and Domazet-Loso, 2015.</p>
<p>This example shall illustrate how the <code>PlotEnrichment()</code> function can be used to trace the evolutionary origin of tissue or process specific genes by investigating their age enrichment.</p>
<p>In case users have an <code>ExpressionSet</code> storing the <code>Phylostratigraphic Map</code> of <em>D. rerio</em> as well as an expression set, they can furthermore use the <code>PlotGeneSet()</code> function implemented in <code>myTAI</code> to visualize the expression levels of brain specific genes which have been shown to be significantly enriched in <code>Metazoa</code> specific phylostrata.</p>
<p>Example:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># the best parameter setting to visualize this plot:</span></span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="co"># png(&quot;DrerioBrainSpecificGeneExpression.png&quot;,700,400)</span></span>
<span id="cb16-3"><a href="#cb16-3"></a><span class="kw">PlotGeneSet</span>(<span class="dt">ExpressionSet =</span> DrerioPhyloExpressionSet,</span>
<span id="cb16-4"><a href="#cb16-4"></a>            <span class="dt">gene.set      =</span> Drerio.Brain.Genes,</span>
<span id="cb16-5"><a href="#cb16-5"></a>            <span class="dt">plot.legend   =</span> <span class="ot">FALSE</span>,</span>
<span id="cb16-6"><a href="#cb16-6"></a>            <span class="dt">type          =</span> <span class="st">&quot;l&quot;</span>,</span>
<span id="cb16-7"><a href="#cb16-7"></a>            <span class="dt">lty           =</span> <span class="dv">1</span>,</span>
<span id="cb16-8"><a href="#cb16-8"></a>            <span class="dt">lwd           =</span> <span class="dv">4</span>,</span>
<span id="cb16-9"><a href="#cb16-9"></a>            <span class="dt">xlab          =</span> <span class="st">&quot;Ontogeny&quot;</span>,</span>
<span id="cb16-10"><a href="#cb16-10"></a>            <span class="dt">ylab          =</span> <span class="st">&quot;Expression Level&quot;</span>)</span>
<span id="cb16-11"><a href="#cb16-11"></a></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co"># dev.off()</span></span></code></pre></div>
<p>Here <code>DrerioPhyloExpressionSet</code> denotes a hypothetical <code>ExpressionSet</code> of <em>D. rerio</em> development.</p>
<p>Additionally, the <code>SelectGeneSet()</code> function allows users to obtain the <code>ExpresisonSet</code> subset of selected genes (<code>gene.set</code>) for subsequent analyses.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># select the ExpressionSet subset of Brain specific genes</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>Brain.PhyloExpressionSet &lt;-<span class="st"> </span><span class="kw">SelectGeneSet</span>( <span class="dt">ExpressionSet =</span> DrerioPhyloExpressionSet,</span>
<span id="cb17-3"><a href="#cb17-3"></a>                                           <span class="dt">gene.set      =</span> Drerio.Brain.Genes )</span>
<span id="cb17-4"><a href="#cb17-4"></a>        </span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="kw">head</span>(Brain.PhyloExpressionSet)</span></code></pre></div>
<div id="adjust-p-values-for-multiple-comparisons" class="section level3">
<h3>Adjust P-values for Multiple Comparisons</h3>
<p>In case a large number of Phylostrata or Divergence Strata is included in the input <code>ExpressionSet</code>, p-values returned by <code>PlotEnrichment()</code> should be adjusted for multiple comparisons. For this purpose <code>PlotEnrichment()</code> includes the argument <code>p.adjust.method</code>. Here, all methods implemented in <code>?p.adjust</code> can be specified:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># adjust p-values for multiple comparisons with Benjamini &amp; Hochberg (1995)</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="kw">PlotEnrichment</span>(Drerio.PhyloMap,</span>
<span id="cb18-3"><a href="#cb18-3"></a>               <span class="dt">test.set        =</span> Drerio.Brain.Genes,</span>
<span id="cb18-4"><a href="#cb18-4"></a>               <span class="dt">measure         =</span> <span class="st">&quot;log-foldchange&quot;</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>               <span class="dt">complete.bg     =</span> <span class="ot">FALSE</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>               <span class="dt">use.only.map    =</span> <span class="ot">TRUE</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>               <span class="dt">legendName      =</span> <span class="st">&quot;PS&quot;</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>               <span class="dt">p.adjust.method =</span> <span class="st">&quot;BH&quot;</span>)</span></code></pre></div>
<p>Please consult these reviews (<a href="http://www.biostathandbook.com/multiplecomparisons.html">Biostatistics Handbook</a>, <a href="http://www.stat.columbia.edu/~gelman/research/published/multiple2f.pdf">Gelman et al., 2008</a>, and <a href="http://www.gs.washington.edu/academics/courses/akey/56008/lecture/lecture10.pdf">Slides</a>) to decide whether or not to apply p-value adjustment to your own dataset.</p>
</div>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Sestak MS and Domazet-Loso T. <strong>Phylostratigraphic Profiles in Zebrafish Uncover Chordate Origins of the Vertebrate Brain</strong>. <em>Mol. Biol. Evol.</em> (2015) 32 (2): 299-312.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
